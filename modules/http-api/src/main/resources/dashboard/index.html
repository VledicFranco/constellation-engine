<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constellation Dashboard</title>
    <!-- Cytoscape.js for DAG visualization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <!-- Dagre for hierarchical layouts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
  <script type="module" crossorigin src="/static/js/main.js"></script>
  <link rel="modulepreload" crossorigin href="/static/js/zustand-BwY1I4TT.js">
  <link rel="modulepreload" crossorigin href="/static/js/react-Bi0AA0xA.js">
  <link rel="stylesheet" crossorigin href="/static/css/main.css">
</head>
<body>
    <!-- Global Error Banner Mount -->
    <div id="error-banner-mount"></div>

    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-brand">
                <svg class="logo" viewBox="0 0 24 24" width="32" height="32">
                    <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.5"/>
                    <circle cx="12" cy="8" r="2" fill="currentColor"/>
                    <circle cx="8" cy="14" r="2" fill="currentColor"/>
                    <circle cx="16" cy="14" r="2" fill="currentColor"/>
                    <line x1="12" y1="10" x2="8" y2="12" stroke="currentColor" stroke-width="1.5"/>
                    <line x1="12" y1="10" x2="16" y2="12" stroke="currentColor" stroke-width="1.5"/>
                </svg>
                <h1>Constellation</h1>
            </div>
            <nav class="header-nav">
                <button class="nav-btn active" data-view="scripts">Scripts</button>
                <button class="nav-btn" data-view="pipelines">Pipelines</button>
                <button class="nav-btn" data-view="history">History</button>
            </nav>
            <div class="header-actions">
                <button id="module-browser-btn" class="icon-btn" title="Module Browser">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
                    </svg>
                </button>
                <button id="refresh-btn" class="icon-btn" title="Refresh">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Scripts View -->
            <div id="scripts-view" class="view active">
                <!-- File Browser Panel -->
                <aside class="sidebar" id="file-browser-panel">
                    <div class="panel-header">
                        <h2>Files</h2>
                    </div>
                    <div class="panel-content">
                        <div id="file-tree" class="file-tree"></div>
                    </div>
                </aside>

                <!-- Main Editor Area -->
                <section class="main-panel">
                    <div class="panel-header">
                        <div class="file-info">
                            <span id="current-file" class="file-name">Select a script</span>
                        </div>
                        <div class="panel-actions">
                            <button id="run-btn" class="primary-btn" disabled>
                                <svg viewBox="0 0 24 24" width="16" height="16">
                                    <path fill="currentColor" d="M8 5v14l11-7z"/>
                                </svg>
                                Run
                            </button>
                        </div>
                    </div>

                    <!-- Input/Output Section -->
                    <div class="io-container">
                        <div class="io-panel inputs-panel">
                            <div class="io-panel-header">
                                <h3>Inputs</h3>
                                <div id="input-presets-mount"></div>
                            </div>
                            <div id="inputs-form" class="inputs-form">
                                <p class="placeholder-text">Load a script to see inputs</p>
                            </div>
                        </div>
                        <div class="io-panel outputs-panel">
                            <h3>Output</h3>
                            <div id="outputs-display" class="outputs-display">
                                <p class="placeholder-text">Run a script to see outputs</p>
                            </div>
                        </div>
                    </div>

                    <!-- Editor Header (always visible) -->
                    <div class="editor-header" id="editor-header">
                        <div class="editor-title">
                            <h3>Code Editor</h3>
                        </div>
                        <div class="editor-controls">
                            <span id="editor-status" class="editor-status"></span>
                            <h3 class="dag-label">DAG Visualization</h3>
                            <button id="layout-tb" class="layout-btn active" title="Top to Bottom">TB</button>
                            <button id="layout-lr" class="layout-btn" title="Left to Right">LR</button>
                            <span class="separator"></span>
                            <button id="zoom-in" class="icon-btn" title="Zoom In">+</button>
                            <button id="zoom-out" class="icon-btn" title="Zoom Out">-</button>
                            <button id="zoom-fit" class="icon-btn" title="Fit to View">Fit</button>
                        </div>
                    </div>

                    <!-- Editor + DAG Split -->
                    <div class="editor-dag-split" id="editor-dag-split">
                        <!-- Code Editor (left) -->
                        <div class="editor-container expanded" id="editor-container">
                            <div class="editor-body">
                                <div class="code-editor-wrapper">
                                    <pre id="code-highlight" class="code-highlight" aria-hidden="true"></pre>
                                    <textarea id="code-editor-textarea" class="code-textarea"
                                              spellcheck="false" autocomplete="off"
                                              placeholder="Write constellation-lang code here..."></textarea>
                                </div>
                                <div id="editor-error-banner" class="editor-error-banner"></div>
                                <div id="error-panel-mount"></div>
                            </div>
                        </div>

                        <!-- Drag Handle -->
                        <div class="split-handle" id="split-handle"></div>

                        <!-- DAG Visualization (right) -->
                        <div class="dag-container" id="dag-container">
                            <div id="dag-canvas" class="dag-canvas"></div>
                            <div id="dag-legend" class="dag-legend">
                                <div class="legend-item"><span class="legend-dot" style="background:#56d364;border-radius:50%"></span> Input</div>
                                <div class="legend-item"><span class="legend-dot" style="background:#d2a8ff"></span> Operation</div>
                                <div class="legend-item"><span class="legend-dot" style="background:#58a6ff;border-radius:50%"></span> Output</div>
                                <div class="legend-item"><span class="legend-dot" style="background:#ffa657"></span> Literal</div>
                                <div class="legend-item"><span class="legend-dot" style="background:#ff7b72"></span> Conditional</div>
                                <div class="legend-item"><span class="legend-dot" style="background:#f778ba"></span> Merge</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Node Details Panel (hidden until a DAG node is clicked) -->
                <aside class="details-panel" id="node-details-panel" style="display: none;">
                    <div class="panel-header">
                        <h2>Node Details</h2>
                        <button id="close-details" class="icon-btn">&times;</button>
                    </div>
                    <div class="panel-content">
                        <div id="node-details" class="node-details">
                            <p class="placeholder-text">Click a node to see details</p>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- Pipelines View -->
            <div id="pipelines-view" class="view">
                <div class="pipelines-list-panel">
                    <div class="panel-header">
                        <h2>Loaded Pipelines</h2>
                    </div>
                    <div class="panel-content">
                        <div id="pipelines-list" class="pipelines-list"></div>
                    </div>
                    <div class="panel-header suspended-header">
                        <h2>Suspended Executions</h2>
                    </div>
                    <div class="panel-content">
                        <div id="suspended-list" class="suspended-list"></div>
                    </div>
                </div>
                <div class="pipeline-detail-panel">
                    <div class="panel-header">
                        <h2>Pipeline Details</h2>
                    </div>
                    <div class="panel-content">
                        <div id="pipeline-detail" class="pipeline-detail">
                            <p class="placeholder-text">Select a pipeline to view details</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History View -->
            <div id="history-view" class="view">
                <div class="history-list-panel">
                    <div class="panel-header">
                        <h2>Execution History</h2>
                        <div class="filter-controls">
                            <input type="text" id="history-filter" placeholder="Filter by script..." class="filter-input">
                        </div>
                    </div>
                    <div class="panel-content">
                        <div id="history-list" class="history-list"></div>
                    </div>
                </div>
                <div class="history-detail-panel">
                    <div class="panel-header">
                        <h2>Execution Details</h2>
                    </div>
                    <div class="panel-content">
                        <div id="execution-detail" class="execution-detail">
                            <p class="placeholder-text">Select an execution to view details</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <span id="status-message">Ready</span>
            <span id="connection-status" class="status-indicator connected">Connected</span>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <span class="loading-text">Loading...</span>
    </div>

    <!-- DAG Tooltip (positioned fixed, managed by dag-visualizer.js) -->
    <div id="dag-tooltip" class="dag-tooltip"></div>

    <!-- React root for IDE features -->
    <div id="react-root"></div>

    <!-- Vite entry point -->
</body>
</html>
