{"version":3,"mappings":"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","names":["styles","constellationLanguageConfig","constellationTokensProvider","constellationTheme","MonacoEditor","value","onChange","onSave","language","theme","readOnly","height","onEditorReady","containerRef","useRef","editorRef","monacoRef","loading","setLoading","useState","error","setError","useEffect","disposed","monaco","__vitePreload","n","lang","editor","newValue","err","insertText","useCallback","text","selection","range","gotoLine","line","column","monacoMethods","v","jsx","jsxs"],"ignoreList":[],"sources":["../../../../../../../../dashboard/src/components/MonacoEditor.tsx"],"sourcesContent":["/**\r\n * Constellation Dashboard - Monaco Editor Component\r\n *\r\n * A React component that wraps Monaco Editor with Constellation language support.\r\n * Lazy loads Monaco for optimal bundle size and connects to the LSP WebSocket.\r\n */\r\n\r\nimport { useState, useEffect, useRef, useCallback, CSSProperties } from 'react';\r\n\r\nexport interface MonacoEditorProps {\r\n  value: string;\r\n  onChange?: (value: string) => void;\r\n  onSave?: (value: string) => void;\r\n  language?: string;\r\n  theme?: string;\r\n  readOnly?: boolean;\r\n  height?: string | number;\r\n  onEditorReady?: (editor: unknown) => void;\r\n}\r\n\r\nconst styles: Record<string, CSSProperties> = {\r\n  container: {\r\n    width: '100%',\r\n    height: '100%',\r\n    position: 'relative',\r\n  },\r\n  loading: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    height: '100%',\r\n    color: 'var(--text-muted, #6e7681)',\r\n    fontSize: '14px',\r\n    gap: '8px',\r\n  },\r\n  spinner: {\r\n    width: '20px',\r\n    height: '20px',\r\n    border: '2px solid var(--border-primary, #30363d)',\r\n    borderTopColor: 'var(--accent-primary, #58a6ff)',\r\n    borderRadius: '50%',\r\n    animation: 'spin 1s linear infinite',\r\n  },\r\n  editorContainer: {\r\n    width: '100%',\r\n    height: '100%',\r\n  },\r\n  error: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    height: '100%',\r\n    color: 'var(--status-failed, #f85149)',\r\n    fontSize: '14px',\r\n    padding: '20px',\r\n    textAlign: 'center',\r\n  },\r\n};\r\n\r\n// Constellation language definition for Monaco\r\nconst constellationLanguageConfig = {\r\n  comments: {\r\n    lineComment: '#',\r\n  },\r\n  brackets: [\r\n    ['{', '}'],\r\n    ['[', ']'],\r\n    ['(', ')'],\r\n  ],\r\n  autoClosingPairs: [\r\n    { open: '{', close: '}' },\r\n    { open: '[', close: ']' },\r\n    { open: '(', close: ')' },\r\n    { open: '\"', close: '\"' },\r\n    { open: \"'\", close: \"'\" },\r\n  ],\r\n  surroundingPairs: [\r\n    { open: '{', close: '}' },\r\n    { open: '[', close: ']' },\r\n    { open: '(', close: ')' },\r\n    { open: '\"', close: '\"' },\r\n    { open: \"'\", close: \"'\" },\r\n  ],\r\n};\r\n\r\nconst constellationTokensProvider = {\r\n  tokenizer: {\r\n    root: [\r\n      // Comments\r\n      [/#.*$/, 'comment'],\r\n\r\n      // Keywords\r\n      [/\\b(in|out|when|module|import|from|as|true|false|null)\\b/, 'keyword'],\r\n\r\n      // Type annotations\r\n      [/:\\s*(String|Int|Float|Boolean|List|Map|Any|Option)\\b/, 'type'],\r\n\r\n      // Module calls (PascalCase identifiers followed by parentheses)\r\n      [/[A-Z][a-zA-Z0-9_]*(?=\\s*\\()/, 'function'],\r\n\r\n      // Variable assignments\r\n      [/[a-z_][a-zA-Z0-9_]*(?=\\s*=)/, 'variable'],\r\n\r\n      // Operators\r\n      [/[=+\\-*/<>!&|?:]+/, 'operator'],\r\n\r\n      // Strings\r\n      [/\"([^\"\\\\]|\\\\.)*\"/, 'string'],\r\n      [/'([^'\\\\]|\\\\.)*'/, 'string'],\r\n\r\n      // Numbers\r\n      [/\\b\\d+\\.?\\d*\\b/, 'number'],\r\n\r\n      // Identifiers\r\n      [/[a-zA-Z_][a-zA-Z0-9_]*/, 'identifier'],\r\n\r\n      // Brackets\r\n      [/[{}()\\[\\]]/, 'delimiter.bracket'],\r\n\r\n      // Punctuation\r\n      [/[,.]/, 'delimiter'],\r\n    ],\r\n  },\r\n};\r\n\r\n// Dark theme matching dashboard\r\nconst constellationTheme = {\r\n  base: 'vs-dark' as const,\r\n  inherit: true,\r\n  rules: [\r\n    { token: 'comment', foreground: '6e7681', fontStyle: 'italic' },\r\n    { token: 'keyword', foreground: 'ff7b72' },\r\n    { token: 'type', foreground: '79c0ff' },\r\n    { token: 'function', foreground: 'd2a8ff' },\r\n    { token: 'variable', foreground: 'ffa657' },\r\n    { token: 'string', foreground: 'a5d6ff' },\r\n    { token: 'number', foreground: '79c0ff' },\r\n    { token: 'operator', foreground: 'ff7b72' },\r\n    { token: 'identifier', foreground: 'c9d1d9' },\r\n    { token: 'delimiter.bracket', foreground: '8b949e' },\r\n    { token: 'delimiter', foreground: '8b949e' },\r\n  ],\r\n  colors: {\r\n    'editor.background': '#0d1117',\r\n    'editor.foreground': '#c9d1d9',\r\n    'editor.lineHighlightBackground': '#161b22',\r\n    'editor.selectionBackground': '#264f78',\r\n    'editorCursor.foreground': '#58a6ff',\r\n    'editorLineNumber.foreground': '#6e7681',\r\n    'editorLineNumber.activeForeground': '#c9d1d9',\r\n    'editor.inactiveSelectionBackground': '#264f7855',\r\n  },\r\n};\r\n\r\nexport function MonacoEditor({\r\n  value,\r\n  onChange,\r\n  onSave,\r\n  language = 'constellation',\r\n  theme = 'constellation-dark',\r\n  readOnly = false,\r\n  height = '100%',\r\n  onEditorReady,\r\n}: MonacoEditorProps) {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const editorRef = useRef<unknown>(null);\r\n  const monacoRef = useRef<typeof import('monaco-editor') | null>(null);\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Initialize Monaco editor\r\n  useEffect(() => {\r\n    let disposed = false;\r\n\r\n    const initMonaco = async () => {\r\n      try {\r\n        // Dynamically import Monaco\r\n        const monaco = await import('monaco-editor');\r\n\r\n        if (disposed) return;\r\n\r\n        monacoRef.current = monaco;\r\n\r\n        // Register Constellation language\r\n        if (!monaco.languages.getLanguages().some((lang) => lang.id === 'constellation')) {\r\n          monaco.languages.register({ id: 'constellation' });\r\n          monaco.languages.setLanguageConfiguration('constellation', constellationLanguageConfig);\r\n          monaco.languages.setMonarchTokensProvider('constellation', constellationTokensProvider);\r\n        }\r\n\r\n        // Register theme\r\n        monaco.editor.defineTheme('constellation-dark', constellationTheme);\r\n\r\n        // Create editor\r\n        if (containerRef.current) {\r\n          const editor = monaco.editor.create(containerRef.current, {\r\n            value,\r\n            language,\r\n            theme,\r\n            readOnly,\r\n            automaticLayout: true,\r\n            minimap: { enabled: false },\r\n            fontSize: 13,\r\n            fontFamily: \"'SF Mono', 'Consolas', 'Monaco', monospace\",\r\n            lineNumbers: 'on',\r\n            scrollBeyondLastLine: false,\r\n            wordWrap: 'on',\r\n            tabSize: 2,\r\n            insertSpaces: true,\r\n            renderWhitespace: 'selection',\r\n            padding: { top: 8, bottom: 8 },\r\n          });\r\n\r\n          editorRef.current = editor;\r\n\r\n          // Handle content changes\r\n          editor.onDidChangeModelContent(() => {\r\n            const newValue = editor.getValue();\r\n            onChange?.(newValue);\r\n          });\r\n\r\n          // Handle save shortcut (Ctrl/Cmd+S)\r\n          editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyS, () => {\r\n            onSave?.(editor.getValue());\r\n          });\r\n\r\n          onEditorReady?.(editor);\r\n        }\r\n\r\n        setLoading(false);\r\n      } catch (err) {\r\n        console.error('Failed to load Monaco editor:', err);\r\n        setError('Failed to load editor. Please refresh the page.');\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    initMonaco();\r\n\r\n    return () => {\r\n      disposed = true;\r\n      if (editorRef.current && monacoRef.current) {\r\n        (editorRef.current as { dispose: () => void }).dispose();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Update value when prop changes\r\n  useEffect(() => {\r\n    if (editorRef.current && monacoRef.current) {\r\n      const editor = editorRef.current as { getValue: () => string; setValue: (v: string) => void };\r\n      if (editor.getValue() !== value) {\r\n        editor.setValue(value);\r\n      }\r\n    }\r\n  }, [value]);\r\n\r\n  // Insert text at cursor position\r\n  const insertText = useCallback((text: string) => {\r\n    if (editorRef.current && monacoRef.current) {\r\n      const editor = editorRef.current as {\r\n        getSelection: () => { startLineNumber: number; startColumn: number } | null;\r\n        executeEdits: (source: string, edits: unknown[]) => void;\r\n        focus: () => void;\r\n      };\r\n      const selection = editor.getSelection();\r\n      if (selection) {\r\n        const range = {\r\n          startLineNumber: selection.startLineNumber,\r\n          startColumn: selection.startColumn,\r\n          endLineNumber: selection.startLineNumber,\r\n          endColumn: selection.startColumn,\r\n        };\r\n        editor.executeEdits('insert', [{ range, text }]);\r\n        editor.focus();\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Go to specific line/column\r\n  const gotoLine = useCallback((line: number, column?: number) => {\r\n    if (editorRef.current && monacoRef.current) {\r\n      const editor = editorRef.current as {\r\n        revealLineInCenter: (line: number) => void;\r\n        setPosition: (pos: { lineNumber: number; column: number }) => void;\r\n        focus: () => void;\r\n      };\r\n      editor.revealLineInCenter(line);\r\n      editor.setPosition({ lineNumber: line, column: column || 1 });\r\n      editor.focus();\r\n    }\r\n  }, []);\r\n\r\n  // Expose methods via window for vanilla JS bridge\r\n  useEffect(() => {\r\n    const monacoMethods = {\r\n      insertText,\r\n      gotoLine,\r\n      getValue: () => {\r\n        if (editorRef.current) {\r\n          return (editorRef.current as { getValue: () => string }).getValue();\r\n        }\r\n        return '';\r\n      },\r\n      setValue: (v: string) => {\r\n        if (editorRef.current) {\r\n          (editorRef.current as { setValue: (v: string) => void }).setValue(v);\r\n        }\r\n      },\r\n    };\r\n\r\n    (window as Window & { monacoEditor?: typeof monacoMethods }).monacoEditor = monacoMethods;\r\n\r\n    return () => {\r\n      delete (window as Window & { monacoEditor?: typeof monacoMethods }).monacoEditor;\r\n    };\r\n  }, [insertText, gotoLine]);\r\n\r\n  if (error) {\r\n    return <div style={{ ...styles.container, ...styles.error }}>{error}</div>;\r\n  }\r\n\r\n  return (\r\n    <div style={{ ...styles.container, height }}>\r\n      {loading && (\r\n        <div style={styles.loading}>\r\n          <div style={styles.spinner} />\r\n          Loading editor...\r\n        </div>\r\n      )}\r\n      <div\r\n        ref={containerRef}\r\n        style={{\r\n          ...styles.editorContainer,\r\n          display: loading ? 'none' : 'block',\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MonacoEditor;\r\n"],"file":"static/js/MonacoEditor-TttX6-Ii.js"}